<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A map of current and upcoming vergeside pickups in Perth, Western Australia.">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
    <title>Vergeside Pickup Map for Perth</title>
    
    <!-- Mapbox Token Configuration (FOR LOCAL DEVELOPMENT ONLY) -->
    <script>
        /*
         * FOR LOCAL DEVELOPMENT ONLY
         * Replace this with your Mapbox token for local testing
         * In production, this will be overridden by environment variables
         */
        window.MAPBOX_TOKEN = 'pk.eyJ1IjoidHJlbnRpY2xlIiwiYSI6ImNtOTBuOXpzejBoNmgyaW9qNmtnbjN6aXgifQ.PdksWcpgaxxC-faGq59gPQ';
        
        // Apply the token to mapboxgl if available
        if (typeof mapboxgl !== 'undefined') {
            mapboxgl.accessToken = window.MAPBOX_TOKEN;
        }
    </script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker@3.1.0/daterangepicker.css">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <link rel="stylesheet" href="css/site.css">
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
            <div class="container">
                <a class="navbar-brand" href="index.html">Perth Vergeside Pickup Dates</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" 
                        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link text-dark" href="index.html">Map</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" href="council.html">Councils</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" href="about.html">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" href="faq.html">FAQ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" href="contact.html">Contact</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" href="donate.html">Support the Site</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <main role="main" class="pb-3">
            <div class="row">
                <div class="col-12">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group mb-3">
                                <label for="daterange">Date Range:</label>
                                <input type="text" class="form-control" id="daterange" name="daterange">
                            </div>
                        </div>
                    </div>
                    
                    <div id="map-container" class="my-4" style="height: 600px;">
                        <div id="map" style="height: 100%;"></div>
                    </div>
                    
                    <div id="map-legend" class="card mt-3">
                        <div class="card-header">Legend</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-2">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #ff4000;"></span>
                                        <span>This Week</span>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #ffbf00;"></span>
                                        <span>Next Week</span>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #ffff00;"></span>
                                        <span>In 2 Weeks</span>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #80ff00;"></span>
                                        <span>In 3-4 Weeks</span>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #00ff80;"></span>
                                        <span>In 5-6 Weeks</span>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #0080ff;"></span>
                                        <span>In 7+ Weeks</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>About Vergeside Pickups</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <p>
                                        Vergeside pickups (also known as bulk rubbish collection) are when your local council 
                                        collects large household items from the front of your property.
                                    </p>
                                    <p>
                                        This service is typically offered 1-4 times per year depending on your local council.
                                    </p>
                                    <p>
                                        Use this map to check when your next collection is scheduled, and plan accordingly.
                                    </p>
                                </div>
                                <div class="col-md-4 text-center">
                                    <a href="about.html" class="btn btn-primary mt-3">Learn More</a>
                                    <a href="donate.html" class="btn btn-outline-primary mt-3 ms-2">Support the Site</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <footer class="border-top footer text-muted">
        <div class="container">
            &copy; 2025 Vergeside - <a href="contact.html">Contact</a>
        </div>
    </footer>

    <!-- Analytics -->
    <script defer data-domain="vergeside.com.au" src="https://data.bjnoel.com/js/script.js"></script>

    <!-- Scripts - Core Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1.0/daterangepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@1.9.10/dist/htmx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.6/dist/umd/supabase.min.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    

    <!-- Environment & Configuration - MUST LOAD FIRST -->
    <script src="js/env-config.js"></script>
    <script src="js/config.js"></script>
    
    <!-- Application Scripts - Load after config -->
    <script src="js/kml-service.js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/mapbox-controller.js"></script>
    <script src="js/site.js"></script>
    
    <!-- Initialize Mapbox Map -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // The token should already be set in the above script
            // Just initialize the map directly without further validation
            initMap();
        });
    </script>
</body>
</html>